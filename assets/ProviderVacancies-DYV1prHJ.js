import{r as i,j as e,C,aF as D,X as G,a5 as s,a6 as L}from"./vendor-BE_QrNRA.js";import{u as $,A as S,b as W}from"./index-De_cGZWt.js";import{M as q}from"./Menu-l-w8lJcy.js";import{V as F}from"./Vacancy-BSUrK8Y6.js";import{G as K}from"./geolocationService-Cv-h-3ra.js";import{S as U}from"./SupportButton-C9Cgi7QZ.js";import"./monetaryUtil-PAfO6RE4.js";import"./useConfirmation-YuXM9JRY.js";import"./images-DlAOhzUc.js";import"./Loading-CinVEkVQ.js";import"./successAnimation-C1ByJTMN.js";import"./index-BNajdFMh.js";function oe(){const{authToken:l}=$(),b=i.useRef(!1),v=i.useRef(!1),[r,k]=i.useState(null),[f,d]=i.useState([]),[A,x]=i.useState(!0),[h,E]=i.useState(1),[j,y]=i.useState(!0),[I,R]=i.useState(!1),[c,V]=i.useState(null),P=async()=>{if(b.current=!0,l){const a=await W.getProviderByUser(l);k(a)}},w=async a=>{if(v.current=!0,x(!0),l&&r){const t=await S.request({origin:"Web",method:"GET",url:`/providers/${r.id}/filtered-vacancies?page=${a}&limit=5`,authToken:l});if(t.success&&t.data){const n=t.data;d(o=>{const m=[...o];return n.forEach(u=>{m.some(g=>g.id===u.id)||m.push(u)}),m}),y(n.length>0)}else d([]),y(!1),x(!1)}x(!1)},M=()=>{j&&(E(a=>a+1),w(h+1))},B=()=>{const a=L("https://freela-servicos.duckdns.org");V(a),a.on("contractorCreatedVacancy",async t=>{if(r.desiredJobVacancy.includes(t.assignment)&&r.latitude!==0&&r.longitude!==0&&l){const n={latitude:r.latitude,longitude:r.longitude},o=await S.request({origin:"Web",method:"GET",url:`/contractors/${t.contractorId}`,authToken:l});if(o.success&&o.data){const m=o.data,u={latitude:m.latitude,longitude:m.longitude};if(u.latitude!==0&&u.longitude!==0){const N=await K.getCoordinatesDistanceInKilometers(n,u),g=r.mileageRadius;N<=g&&d(p=>p.some(T=>T.id===t.id)?p:[t,...p])}}}}),a.on("contractorDeletedVacancy",t=>{d(n=>n.filter(o=>o.id!==t))}),a.on("contractorAcceptedCandidacy",t=>{r.id===t.providerId&&d(n=>n.filter(o=>o.id!==t.vacancyId))}),a.on("contractorRejectedCandidacy",t=>{r.id===t.providerId&&d(n=>n.filter(o=>o.id!==t.vacancyId))})};return i.useEffect(()=>{if(!v.current&&r)return w(h),B(),()=>{c&&c.connected&&(c.off("contractorCreatedVacancy"),c.off("contractorDeletedVacancy"),c.off("contractorAcceptedCandidacy"),c.off("contractorRejectedCandidacy"),c.disconnect())}},[r]),i.useEffect(()=>{b.current||P()},[]),e.jsxs(e.Fragment,{children:[r?e.jsx("div",{className:"flex items-start justify-center w-full min-h-screen bg-secondaryColor desktop:px-96 laptop:px-44 tablet:px-20 mobile:px-2 tablet:pb-32 mobile:pb-28",children:e.jsx("div",{className:"flex flex-row w-full h-full mobile:flex-col mobile:justify-start",children:e.jsxs("div",{className:"mt-1 w-full min-h-[80vh]",children:[e.jsx("span",{className:"text-lg font-semibold underline text-tertiaryColor underline-offset-8",children:"Vagas disponÃ­veis"}),A&&h===1?e.jsx("div",{className:"w-full min-h-[80vh] flex justify-center items-center",children:e.jsx(C,{weight:"bold",className:"w-14 h-14 animate-spin text-tertiaryColor"})}):e.jsx(D,{dataLength:f.length,next:M,hasMore:j,loader:e.jsx("div",{className:"flex items-center justify-center w-full h-24",children:e.jsx(C,{weight:"bold",className:"w-8 h-8 animate-spin text-tertiaryColor"})}),endMessage:e.jsx("p",{className:"text-center",children:"Nenhuma vaga encontrada"}),children:f.length===0?e.jsx("div",{className:"flex items-center justify-center w-full h-full mt-10 text-center text-tertiaryColor",children:"Nenhuma vaga encontrada"}):f.map((a,t)=>e.jsx(F,{vacancy:a,provider:r,profileType:"provider",disabledApplyCandidacyButton:I,setDisabledApplyCandidacyButton:R},t))})]})})}):e.jsx("div",{className:"w-full h-screen desktop:px-80 laptop:px-36 tablet:px-24 mobile:px-2 mobile:pt-2 mobile:pb-32 bg-secondaryColor",children:e.jsxs(G,{children:[e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"7.5rem",height:"1rem",className:"mx-auto mt-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"7.5rem",height:"0.6rem",className:"mt-[1.75rem] mb-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:"3rem",className:"rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"8.5rem",height:"0.6rem",className:"mt-[1.75rem] mb-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:"3rem",className:"rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"5rem",height:"0.6rem",className:"mt-[1.75rem] mb-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:"16rem",className:"rounded-md"}),e.jsxs("div",{className:"flex justify-start w-full h-24 laptop:flex-row mobile:flex-col",children:[e.jsxs("div",{className:"flex flex-row desktop:w-[50%] laptop:w-[60%] tablet:w-[60%] mobile:w-full laptop:justify-start mobile:justify-between",children:[e.jsxs("div",{className:"flex flex-col w-[17rem]",children:[e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"7.5rem",height:"0.6rem",className:"mt-[1.75rem] mb-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:"3rem",className:"rounded-md"})]}),e.jsx("div",{className:"flex items-end justify-center w-10 h-full",children:e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"55%",height:"0.2rem",className:"mb-6 rounded-md"})}),e.jsxs("div",{className:"flex flex-col w-[7.5rem]",children:[e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"7.5rem",height:"0.6rem",className:"mt-[1.75rem] mb-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:"3rem",className:"rounded-md"})]})]}),e.jsxs("div",{className:"flex flex-col w-full laptop:ml-10",children:[e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"7.5rem",height:"0.6rem",className:"mt-[1.75rem] mb-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:"3rem",className:"rounded-md"})]})]})]})}),e.jsx(q,{profileType:"provider",pageSelected:"findVacancies"}),e.jsx(U,{})]})}export{oe as ProviderVacancies};
